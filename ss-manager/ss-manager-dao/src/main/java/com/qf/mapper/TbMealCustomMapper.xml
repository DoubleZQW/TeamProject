<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.qf.mapper.TbMealCustomMapper">
    <sql id="Base_Column_List">
   m.meal_id as mealId ,m.meal_name as mealName, m.meal_price as mealPrice,
   m.meal_num as mealNum, m.meal_picture as mealPicture ,m.meal_status as mealStatus,
   m.publisher as publisher ,m.meal_intro as mealIntro ,m.category as category,
   m.create_tme as createTme ,m.updat_time as updatTime, m.cat_id as catId,
   c.cat_name as catName
    </sql>
    <sql id="Where_Clause">
        <where>
            m.meal_status !=3
            <if test="query !=null and query.mealName!=null and query.mealName!= ''">
                and m.meal_name like '%${query.mealName}%'
            </if>
            <if test="query !=null and query.publisher !=null and query.publisher != '' ">
                and m.publisher like '%${query.publisher}%'
            </if>
            <if test="query !=null and query.status !=null and query.status !=0">
                and m.meal_status = #{query.status}
            </if>
        </where>
    </sql>
    <select id="listItemsByPage" resultType="com.qf.pojo.TbMeal">
        select
        <include refid="Base_Column_List"/>
        from tb_meal m LEFT JOIN tb_meal_cat c
        ON m.meal_id =c.id
        <include refid="Where_Clause"/>
        <choose>
            <when test="order != null and order.sort != null and order.order != null">
                <!--<foreach collection="order.orderParams" open="order by " close=""
                         separator="," item="item">
                    m.${item}
                </foreach>-->
                ORDER BY ${order.sort} ${order.order}
            </when>
            <otherwise>
                order by m.meal_id asc
            </otherwise>
        </choose>
        limit #{page.offset},#{page.rows}
    </select>
    <select id="listCondition" resultType="_long">
        select
        count(*)
        from tb_meal m
        <include refid="Where_Clause"/>
    </select>

    <!--根据mealId查询 TbMealCustom-->
    <select id="findMealCustomById" resultType="com.qf.vo.TbMealCustom">
        select
        <include refid="Base_Column_List"/>
        from tb_meal m LEFT JOIN tb_meal_cat c
        ON m.meal_id =c.id
        where m.meal_id =#{mealId}
    </select>

    <!--更新商品-->
    <update id="updateMealCustom">

    </update>

    <!--查询meal到(TbSearchMealCustom)索引库-->
    <select id="getSearchMealList" resultType="com.qf.vo.TbSearchMealCustom">
        select
        m.meal_id as mealId,
        m.meal_name as mealName,
        m.meal_price as mealPrice,
        m.meal_num as mealNum,
        m.meal_picture as mealPic,
        m.meal_intro as mealIntro,
        m.publisher as publisher
        from tb_meal m
        where
        m.meal_status = 1
        order by m.meal_id desc;
    </select>
</mapper>